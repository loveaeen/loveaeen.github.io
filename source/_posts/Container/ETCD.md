---
title: ETCD
date: 2022-03-28 16:45:12
excerpt: etcd是CoreOS团队于2013年6月发起的开源项目，它的目标是构建一个高可用的分布式键值(key-value)数据库。etcd内部采用Raft协议作为一致性算法，etcd基于Go语言实现。
categories: Container
tags: Kubernetes
typora-root-url: ../../
---

## 简介

etcd是CoreOS团队于2013年6月发起的开源项目，它的目标是构建一个高可用的分布式键值(key-value)数据库。etcd内部采用Raft协议作为一致性算法，etcd基于Go语言实现。

- 简单：提供定义明确且面向用户的API
- 安全：支持SSL证书验证
- 性能：基准压测支持1w+/sec写入
- 可靠：采用Raft协议保证分布式系统数据的可用性和一致性。

## 使用场景

配置中心：etcd是一个分布式的键值存储系统，其优秀的读写性能、一致性和可用性的机制，非常适合用来做配置中心角色。

**分布式锁：**etcd的强一致性保证，可以用来做分布式场景下的同步机制保证。

Leader选举：分布式场景下，常采用leader-follower模式来保证有状态服务的高可用（即使leader挂掉，其他follower立马补上），比如k8s和kafka partition高可用机制。可以很方便的借助etcd来实现leader选举机制。

服务注册发现：为了解决微服务场景下，服务地址的注册和发现问题。和配置中心功能类似，不同之处在于服务注册和服务发现，还伴随着状态检测。

消息订阅和发布：etcd内置watch机制，完全可以实现一个小型的消息订阅和发布组件。

## 产品对比

**Redis：**etcd诞生之日起，就定位成一种分布式存储系统，并在k8s 服务注册和服务发现中，为大家所认识。它偏重的是节点之间的通信和一致性的机制保证，并不强调单节点的读写性能。

而redis最早作为缓存系统出现在大众视野，也注定了redis需要更加侧重于读写性能和支持更多的存储模式，它不需要care一致性，也不需要侧重事务，因此可以达到很高的读写性能。

总结一下，redis常用来做缓存系统，etcd常用来做分布式系统中一些关键数据的存储服务，比如服务注册和服务发现。

**Zookeeper：**「服务发现」**是开发者考虑 etcd 的主要原因，**「高性能，易于生成节点特定配置」**被认为是选择 Zookeeper 的关键因素。

而且Zookeeper的虚拟节点可以在客户端断开后立马检测到，而etcd要靠keepAlive续约机制，超过几秒不续约了，则认为掉线了。